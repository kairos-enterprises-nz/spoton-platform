# Airflow Keycloak OIDC Configuration
# Add these settings to your airflow.cfg or set as environment variables

[webserver]
# Enable authentication
authenticate = True
auth_backend = airflow.providers.keycloak.auth.keycloak_auth

# Keycloak OAuth configuration
oauth_providers = [{
    "name": "keycloak",
    "token_key": "access_token", 
    "icon": "fa-key",
    "remote_app": {
        "client_id": "airflow-live",
        "client_secret": "${AIRFLOW_KEYCLOAK_SECRET}",
        "server_metadata_url": "https://auth.spoton.co.nz/realms/spoton-system/.well-known/openid_configuration",
        "client_kwargs": {
            "scope": "openid email profile groups"
        }
    }
}]

# Security settings
expose_config = False
filter_by_owner = True
default_dag_run_display_number = 25

# Session configuration
session_lifetime_minutes = 30
force_log_out_after = 0
auto_refresh_interval = 30

# RBAC settings
rbac = True

[core]
# Executor configuration
executor = LocalExecutor

# Security
enable_xcom_pickling = False
killed_task_cleanup_time = 60

# Logging
logging_level = INFO
fab_logging_level = WARN

[scheduler]
# DAG processing
dag_dir_list_interval = 300
dag_file_processor_timeout = 50
dagbag_import_timeout = 30

# Task scheduling
max_threads = 2
catchup_by_default = False

[database]
# Connection pooling
sql_alchemy_pool_size = 10
sql_alchemy_max_overflow = 20
sql_alchemy_pool_recycle = 3600

[smtp]
# Email configuration (optional)
smtp_host = localhost
smtp_starttls = True
smtp_ssl = False
smtp_port = 587
smtp_mail_from = airflow@spoton.co.nz

[celery]
# Celery configuration (if using CeleryExecutor)
worker_concurrency = 16
worker_log_server_port = 8793

[kubernetes]
# Kubernetes configuration (if using KubernetesExecutor)
namespace = airflow
delete_worker_pods = True
worker_pods_creation_batch_size = 1

[api]
# API authentication
auth_backend = airflow.api.auth.backend.default 